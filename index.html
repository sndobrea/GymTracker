<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Tracker</title>

    <link rel="icon" href="https://img.icons8.com/fluency/96/dumbbell.png" type="image/png">
  
    <!-- 1. Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {},
            },
        }
    </script>

    <!-- 2. React & ReactDOM (via CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel (pentru a citi codul React direct in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Lucide Icons (Wrapper pentru React) -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-zinc-50 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-50 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICON COMPONENTS (Manual definition for CDN compatibility) ---
        // Folosim o funcție helper pentru a crea iconițele Lucide ca și componente React
        const Icon = ({ name, size = 24, className = "" }) => {
            const svgRef = useRef(null);
            useEffect(() => {
                if (svgRef.current) {
                    lucide.createIcons({
                        icons: { [name]: lucide.icons[name] },
                        nameAttr: 'data-lucide',
                        attrs: { class: className, width: size, height: size }
                    });
                    // Lucide înlocuiește tag-ul <i> sau <svg>, noi trebuie să ne asigurăm că îl randează corect
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    iconElement.setAttribute('width', size);
                    iconElement.setAttribute('height', size);
                    iconElement.setAttribute('class', className);
                    if(svgRef.current) {
                        svgRef.current.innerHTML = '';
                        svgRef.current.appendChild(iconElement);
                        lucide.createIcons({ root: svgRef.current });
                    }
                }
            }, [name, size, className]);

            return <span ref={svgRef} className="inline-flex items-center justify-center" />;
        };

        // Mapam numele iconitelor folosite in aplicatie
        const Plus = (props) => <Icon name="plus" {...props} />;
        const ChevronLeft = (props) => <Icon name="chevron-left" {...props} />;
        const ChevronRight = (props) => <Icon name="chevron-right" {...props} />;
        const Trash2 = (props) => <Icon name="trash-2" {...props} />;
        const Dumbbell = (props) => <Icon name="dumbbell" {...props} />;
        const Settings = (props) => <Icon name="settings" {...props} />;
        const CheckCircle2 = (props) => <Icon name="check-circle-2" {...props} />;
        const Activity = (props) => <Icon name="activity" {...props} />;
        const Moon = (props) => <Icon name="moon" {...props} />;
        const Sun = (props) => <Icon name="sun" {...props} />;
        const TrendingUp = (props) => <Icon name="trending-up" {...props} />;
        const BarChart3 = (props) => <Icon name="bar-chart-3" {...props} />;
        const CalendarDays = (props) => <Icon name="calendar-days" {...props} />;
        const Target = (props) => <Icon name="target" {...props} />;
        const Download = (props) => <Icon name="download" {...props} />;
        const Upload = (props) => <Icon name="upload" {...props} />;
        const Save = (props) => <Icon name="save" {...props} />;
        const AlertCircle = (props) => <Icon name="alert-circle" {...props} />;
        const X = (props) => <Icon name="x" {...props} />;
        const Check = (props) => <Icon name="check" {...props} />;
        const ChevronDown = (props) => <Icon name="chevron-down" {...props} />;
        const CalendarIcon = (props) => <Icon name="calendar" {...props} />;
        const Layers = (props) => <Icon name="layers" {...props} />;


        // --- CONSTANTS ---
        const MUSCLE_GROUPS = [
            { value: 'legs', label: 'Legs' },
            { value: 'shoulders', label: 'Shoulders' },
            { value: 'triceps', label: 'Triceps' },
            { value: 'chest', label: 'Chest' },
            { value: 'back', label: 'Back' },
            { value: 'biceps', label: 'Biceps' },
            { value: 'abs', label: 'Abs' },
            { value: 'cardio', label: 'Cardio' }
        ];

        // --- UI Components ---

        const Button = ({ children, onClick, variant = 'primary', className = '', size = 'md', disabled = false }) => {
            const baseStyle = "inline-flex items-center justify-center rounded-lg font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none active:scale-[0.98]";
            
            const variants = {
                primary: "bg-zinc-900 text-white hover:bg-zinc-800 shadow-sm dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-200",
                secondary: "bg-zinc-100 text-zinc-900 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-700",
                ghost: "hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",
                outline: "border border-zinc-200 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-900",
                destructive: "bg-red-600 text-white hover:bg-red-700 dark:bg-red-900 dark:text-red-50 dark:hover:bg-red-800",
            };

            const sizes = {
                sm: "h-8 px-3 text-xs",
                md: "h-10 px-4 py-2",
                lg: "h-12 px-6 text-lg",
                icon: "h-10 w-10",
            };

            return (
                <button 
                onClick={onClick} 
                disabled={disabled}
                className={`${baseStyle} ${variants[variant]} ${sizes[size]} ${className}`}
                >
                {children}
                </button>
            );
        };

        const Input = ({ label, value, onChange, type = "text", placeholder, className = "" }) => (
            <div className={`flex flex-col gap-2 ${className}`}>
                {label && <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400">{label}</label>}
                <input
                type={type}
                value={value}
                onChange={onChange}
                placeholder={placeholder}
                className="flex h-11 w-full rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-900 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:placeholder:text-zinc-500 dark:focus-visible:ring-zinc-300 transition-shadow"
                />
            </div>
        );

        const Card = ({ children, className = "" }) => (
            <div className={`rounded-xl border border-zinc-200 bg-white text-zinc-950 shadow-sm dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 ${className}`}>
                {children}
            </div>
        );

        // --- Custom Components ---

        const CustomSelect = ({ value, onChange, options, placeholder, label, className = "" }) => {
            const [isOpen, setIsOpen] = useState(false);
            const ref = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                if (ref.current && !ref.current.contains(event.target)) {
                    setIsOpen(false);
                }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const selectedOption = options.find(o => String(o.value) === String(value));

            return (
                <div className={`flex flex-col gap-2 ${className}`} ref={ref}>
                {label && <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400">{label}</label>}
                <div className="relative">
                    <button
                    type="button"
                    onClick={() => setIsOpen(!isOpen)}
                    className="flex h-11 w-full items-center justify-between rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:focus:ring-zinc-300"
                    >
                    <span className={`block truncate ${!selectedOption ? 'text-zinc-500' : ''}`}>
                        {selectedOption ? selectedOption.label : placeholder || "Select..."}
                    </span>
                    <ChevronDown className="h-4 w-4 opacity-50" />
                    </button>

                    {isOpen && (
                    <div className="absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-zinc-200 bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-zinc-800 dark:bg-zinc-950 sm:text-sm">
                        {options.length === 0 ? (
                        <div className="relative cursor-default select-none py-2 px-4 text-zinc-500">No options available</div>
                        ) : (
                        options.map((option) => (
                            <div
                            key={option.value}
                            className={`relative cursor-default select-none py-2 pl-10 pr-4 text-zinc-900 dark:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 ${String(value) === String(option.value) ? 'bg-zinc-100 dark:bg-zinc-800 font-medium' : ''}`}
                            onClick={() => {
                                onChange(option.value);
                                setIsOpen(false);
                            }}
                            >
                            <span className={`block truncate`}>{option.label}</span>
                            {String(value) === String(option.value) ? (
                                <span className="absolute inset-y-0 left-0 flex items-center pl-3 text-zinc-900 dark:text-white">
                                <Check className="h-4 w-4" />
                                </span>
                            ) : null}
                            </div>
                        ))
                        )}
                    </div>
                    )}
                </div>
                </div>
            );
        };

        const CustomDatePicker = ({ label, value, onChange, className = "" }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [viewDate, setViewDate] = useState(value ? new Date(value) : new Date());
            const ref = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                if (ref.current && !ref.current.contains(event.target)) {
                    setIsOpen(false);
                }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const handleDayClick = (day) => {
                const offset = day.getTimezoneOffset();
                const correctedDate = new Date(day.getTime() - (offset * 60 * 1000));
                onChange(correctedDate.toISOString().split('T')[0]);
                setIsOpen(false);
            };

            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

            const generateCalendarDays = () => {
                const year = viewDate.getFullYear();
                const month = viewDate.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month); 
                
                const paddingDays = Array.from({ length: firstDay });
                const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);

                return { paddingDays, days, year, month };
            };

            const { paddingDays, days, year, month } = generateCalendarDays();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

            const changeMonth = (offset) => {
                setViewDate(new Date(year, month + offset, 1));
            };

            return (
                <div className={`flex flex-col gap-2 ${className}`} ref={ref}>
                {label && <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400">{label}</label>}
                <div className="relative">
                    <button
                    type="button"
                    onClick={() => setIsOpen(!isOpen)}
                    className={`flex h-11 w-full items-center justify-start text-left rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-zinc-800 dark:bg-zinc-950 dark:ring-offset-zinc-950 dark:focus:ring-zinc-300 ${!value ? 'text-zinc-500' : ''}`}
                    >
                    <CalendarIcon className="mr-2 h-4 w-4 opacity-50" />
                    {value ? new Date(value).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : <span>Pick a date</span>}
                    </button>

                    {isOpen && (
                    <div className="absolute top-12 left-0 z-50 p-3 rounded-md border border-zinc-200 bg-white text-zinc-950 shadow-md outline-none dark:border-zinc-800 dark:bg-zinc-950 dark:text-zinc-50 w-[280px]">
                        <div className="flex items-center justify-between space-x-1 pb-4">
                        <div className="text-sm font-medium">{monthNames[month]} {year}</div>
                        <div className="flex items-center space-x-1">
                            <button onClick={() => changeMonth(-1)} className="h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 border border-zinc-200 dark:border-zinc-800 rounded flex items-center justify-center hover:bg-zinc-100 dark:hover:bg-zinc-800">
                                <ChevronLeft className="h-4 w-4" />
                            </button>
                            <button onClick={() => changeMonth(1)} className="h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 border border-zinc-200 dark:border-zinc-800 rounded flex items-center justify-center hover:bg-zinc-100 dark:hover:bg-zinc-800">
                                <ChevronRight className="h-4 w-4" />
                            </button>
                        </div>
                        </div>
                        <div className="grid grid-cols-7 gap-1 text-center text-[0.8rem]">
                        {['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(d => (
                            <div key={d} className="text-zinc-500 font-normal">{d}</div>
                        ))}
                        {paddingDays.map((_, i) => <div key={`pad-${i}`} />)}
                        {days.map(day => {
                            const dateStr = new Date(year, month, day).toLocaleDateString('en-CA');
                            const isSelected = value && new Date(value).getDate() === day && new Date(value).getMonth() === month && new Date(value).getFullYear() === year;
                            const isToday = new Date().getDate() === day && new Date().getMonth() === month && new Date().getFullYear() === year;

                            return (
                            <button
                                key={day}
                                onClick={() => handleDayClick(new Date(year, month, day))}
                                className={`
                                h-8 w-8 rounded-md p-0 font-normal aria-selected:opacity-100 flex items-center justify-center
                                ${isSelected ? 'bg-zinc-900 text-zinc-50 hover:bg-zinc-900 hover:text-zinc-50 dark:bg-zinc-50 dark:text-zinc-900' : 'hover:bg-zinc-100 dark:hover:bg-zinc-800'}
                                ${isToday && !isSelected ? 'bg-zinc-100 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-50' : ''}
                                `}
                            >
                                {day}
                            </button>
                            )
                        })}
                        </div>
                    </div>
                    )}
                </div>
                </div>
            )
        }

        const Modal = ({ isOpen, onClose, title, children, footer }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                <div className="w-full max-w-md bg-white dark:bg-zinc-900 rounded-xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden scale-100">
                    <div className="flex items-center justify-between p-4 border-b border-zinc-100 dark:border-zinc-800">
                    <h3 className="font-bold text-lg">{title}</h3>
                    <button onClick={onClose} className="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200">
                        <X className="h-5 w-5" />
                    </button>
                    </div>
                    <div className="p-6">
                    {children}
                    </div>
                    {footer && (
                    <div className="bg-zinc-50 dark:bg-zinc-950/50 p-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-3">
                        {footer}
                    </div>
                    )}
                </div>
                </div>
            );
        };

        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const bgColors = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? <Check className="h-4 w-4" /> : <AlertCircle className="h-4 w-4" />;

            return (
                <div className="fixed bottom-4 right-4 z-50 flex items-center gap-3 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 px-4 py-3 shadow-lg">
                <div className={`rounded-full p-1 text-white ${bgColors}`}>
                    {icon}
                </div>
                <span className="text-sm font-medium">{message}</span>
                </div>
            );
        };

        // --- Logic ---

        const calculateProgression = (exercise, settings, weekIndex, workoutIndexInWeek) => {
            if (!exercise || !settings) return null;

            const { currentWeight, increment, targetReps, targetWeight } = exercise;
            const { totalWeeks, workoutsPerWeek, setsPerWorkout } = settings;

            const startW = parseFloat(currentWeight);
            const endW = parseFloat(targetWeight);
            const stepW = parseFloat(increment);
            const tReps = parseInt(targetReps);
            const tWeeks = parseInt(totalWeeks);
            const wPerWeek = parseInt(workoutsPerWeek);
            const sPerWorkout = parseInt(setsPerWorkout);

            const totalSessions = tWeeks * wPerWeek;
            
            if (weekIndex < 0) weekIndex = 0;
            let currentSessionIdx = (weekIndex * wPerWeek) + workoutIndexInWeek;

            const totalWeightGain = endW - startW;
            const totalWeightSteps = Math.ceil(totalWeightGain / stepW);
            
            if (totalWeightGain <= 0) return { weight: startW, reps: Array(sPerWorkout).fill(tReps) };

            const sessionsPerWeightStep = totalSessions / totalWeightSteps;

            let weightStepIndex = Math.floor(currentSessionIdx / sessionsPerWeightStep);
            if (weightStepIndex > totalWeightSteps) weightStepIndex = totalWeightSteps;

            let calculatedWeight = startW + (weightStepIndex * stepW);
            if (calculatedWeight > endW) calculatedWeight = endW;

            const sessionProgressInCurrentBlock = (currentSessionIdx % sessionsPerWeightStep) / sessionsPerWeightStep;
            
            const minReps = Math.max(1, tReps - 2); 
            const minTotalVolume = sPerWorkout * minReps;
            const maxTotalVolume = sPerWorkout * tReps;

            const currentTotalVolume = Math.floor(minTotalVolume + (sessionProgressInCurrentBlock * (maxTotalVolume - minTotalVolume)));

            const repsDistribution = Array(sPerWorkout).fill(0);
            let remainingVolume = currentTotalVolume;

            for (let i = 0; i < sPerWorkout; i++) {
                const setsLeft = sPerWorkout - i;
                const val = Math.ceil(remainingVolume / setsLeft);
                repsDistribution[i] = val;
                remainingVolume -= val;
            }

            if (currentSessionIdx >= totalSessions) {
                return { weight: endW, reps: Array(sPerWorkout).fill(tReps) };
            }

            return {
                weight: calculatedWeight,
                reps: repsDistribution
            };
        };

        const getWeekNumber = (startDateStr) => {
            if (!startDateStr) return 0;
            const start = new Date(startDateStr);
            const now = new Date();
            const diffTime = Math.abs(now - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            if (now < start) return 0;
            return Math.floor(diffDays / 7);
        };

        // --- Main App ---

        function GymTrackerApp() {
            const [theme, setTheme] = useState('dark');
            const [activeTab, setActiveTab] = useState('tracker');
            
            // Data
            const [settings, setSettings] = useState({
                totalWeeks: 47,
                workoutsPerWeek: 2,
                setsPerWorkout: 3,
                startDate: new Date().toISOString().split('T')[0],
                workoutNames: ["Legs-Shoulders-Triceps", "Chest-Back-Biceps"]
            });

            const [exercises, setExercises] = useState([]);
            const [newExercise, setNewExercise] = useState({
                name: '',
                currentWeight: '',
                increment: 2.5,
                targetReps: 10,
                targetWeight: '',
                assignedWorkout: 0,
                muscleGroup: 'legs'
            });

            const [history, setHistory] = useState({});

            // View State
            const [selectedExerciseId, setSelectedExerciseId] = useState(null);
            const [viewWeekOffset, setViewWeekOffset] = useState(0); 
            const [filterWorkoutIndex, setFilterWorkoutIndex] = useState(0);
            const [filterMuscleGroup, setFilterMuscleGroup] = useState('all'); 
            
            // UI
            const [notification, setNotification] = useState(null);
            const [importModalData, setImportModalData] = useState(null);
            const fileInputRef = useRef(null);

            // Init
            useEffect(() => {
                const savedSettings = localStorage.getItem('gym_settings_v3');
                const savedExercises = localStorage.getItem('gym_exercises_v3');
                const savedHistory = localStorage.getItem('gym_history_v3');
                
                if (savedSettings) {
                    const parsedSettings = JSON.parse(savedSettings);
                    if (!parsedSettings.workoutNames) parsedSettings.workoutNames = ["Workout A", "Workout B"];
                    setSettings(parsedSettings);
                }
                if (savedExercises) {
                    const parsedEx = JSON.parse(savedExercises);
                    const migratedEx = parsedEx.map(e => ({
                    ...e,
                    muscleGroup: e.muscleGroup || 'legs'
                    }));
                    setExercises(migratedEx);
                    
                    const visibleExercises = migratedEx.filter(e => (e.assignedWorkout || 0) === 0);
                    if (visibleExercises.length > 0) setSelectedExerciseId(visibleExercises[0].id);
                }
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            useEffect(() => {
                localStorage.setItem('gym_settings_v3', JSON.stringify(settings));
                localStorage.setItem('gym_exercises_v3', JSON.stringify(exercises));
                localStorage.setItem('gym_history_v3', JSON.stringify(history));
            }, [settings, exercises, history]);

            useEffect(() => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [theme]);

            // Auto-Select Logic
            useEffect(() => {
                if (activeTab === 'tracker') {
                    let filtered = exercises.filter(e => (e.assignedWorkout || 0) === parseInt(filterWorkoutIndex));
                    
                    if (filterMuscleGroup !== 'all') {
                        filtered = filtered.filter(e => e.muscleGroup === filterMuscleGroup);
                    }
                    
                    const currentExists = filtered.find(e => e.id === selectedExerciseId);
                    
                    if (!currentExists && filtered.length > 0) {
                        setSelectedExerciseId(filtered[0].id);
                        setViewWeekOffset(0); 
                    } else if (filtered.length === 0) {
                        setSelectedExerciseId(null);
                    }
                }
            }, [activeTab, filterWorkoutIndex, filterMuscleGroup, exercises]);

            // Actions
            const addExercise = () => {
                if (!newExercise.name || !newExercise.targetWeight) return;
                const exercise = { ...newExercise, id: Date.now().toString(), assignedWorkout: parseInt(newExercise.assignedWorkout) };
                const updatedExercises = [...exercises, exercise];
                setExercises(updatedExercises);
                setNewExercise({ 
                    name: '', 
                    currentWeight: '', 
                    increment: 2.5, 
                    targetReps: 10, 
                    targetWeight: '', 
                    assignedWorkout: 0,
                    muscleGroup: 'legs'
                });
                
                setFilterWorkoutIndex(exercise.assignedWorkout);
                setFilterMuscleGroup('all'); 
                if (!selectedExerciseId) setSelectedExerciseId(exercise.id);
                showNotification('Exercise added successfully', 'success');
            };

            const removeExercise = (id) => {
                const updated = exercises.filter(e => e.id !== id);
                setExercises(updated);
                if (selectedExerciseId === id) setSelectedExerciseId(updated[0]?.id || null);
                showNotification('Exercise removed', 'success');
            };

            const toggleSetComplete = (weekIdx, workoutIdx, setIdx) => {
                if (!selectedExerciseId) return;
                setHistory(prev => ({
                    ...prev,
                    [selectedExerciseId]: {
                        ...prev[selectedExerciseId],
                        [weekIdx]: {
                            ...prev[selectedExerciseId]?.[weekIdx],
                            [workoutIdx]: {
                                ...prev[selectedExerciseId]?.[weekIdx]?.[workoutIdx],
                                [setIdx]: !prev[selectedExerciseId]?.[weekIdx]?.[workoutIdx]?.[setIdx]
                            }
                        }
                    }
                }));
            };

            const updateWorkoutName = (index, name) => {
                const newNames = [...settings.workoutNames];
                newNames[index] = name;
                setSettings({...settings, workoutNames: newNames});
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
            };

            const handleExportData = () => {
                const dataToExport = {
                    version: 'v3',
                    exportDate: new Date().toISOString(),
                    settings,
                    exercises,
                    history
                };

                const dataStr = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `gym_tracker_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showNotification('Backup downloaded successfully', 'success');
            };

            const handleFileSelect = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (importedData.settings && importedData.exercises) {
                            setImportModalData(importedData);
                        } else {
                            showNotification('Invalid backup file format', 'error');
                        }
                    } catch (error) {
                        console.error("Import error:", error);
                        showNotification('Error reading file. Must be valid JSON.', 'error');
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; 
            };

            const confirmImport = () => {
                if (!importModalData) return;
                setSettings(importModalData.settings);
                const migratedEx = importModalData.exercises.map(e => ({
                    ...e,
                    muscleGroup: e.muscleGroup || 'legs'
                }));
                setExercises(migratedEx);
                if (importModalData.history) setHistory(importModalData.history);
                
                setImportModalData(null); 
                showNotification('Data imported successfully!', 'success');
            };

            const triggerFileInput = () => {
                fileInputRef.current?.click();
            };

            // Calculated
            const currentWeekIndex = useMemo(() => getWeekNumber(settings.startDate), [settings.startDate]);
            const displayedWeekIndex = currentWeekIndex + viewWeekOffset;
            
            const routineExercises = useMemo(() => {
                return exercises.filter(e => (e.assignedWorkout || 0) === parseInt(filterWorkoutIndex));
            }, [exercises, filterWorkoutIndex]);

            const availableMuscleGroups = useMemo(() => {
                const groups = new Set(routineExercises.map(e => e.muscleGroup));
                return MUSCLE_GROUPS.filter(g => groups.has(g.value));
            }, [routineExercises]);

            const filteredExercises = useMemo(() => {
                if (filterMuscleGroup === 'all') return routineExercises;
                return routineExercises.filter(e => e.muscleGroup === filterMuscleGroup);
            }, [routineExercises, filterMuscleGroup]);

            const selectedExercise = exercises.find(e => e.id === selectedExerciseId);

            const stats = useMemo(() => {
                if (!selectedExercise) return null;
                const totalGain = selectedExercise.targetWeight - selectedExercise.currentWeight;
                const steps = Math.ceil(totalGain / selectedExercise.increment);
                const weeksPerIncrease = steps > 0 ? (settings.totalWeeks / steps).toFixed(1) : 0;
                const totalSessions = settings.totalWeeks * settings.workoutsPerWeek;
                const currentSessionGlobal = (displayedWeekIndex * settings.workoutsPerWeek); 
                const progressPercent = Math.min(100, Math.round((currentSessionGlobal / totalSessions) * 100));

                return { weeksPerIncrease, progressPercent, steps };
            }, [selectedExercise, settings, displayedWeekIndex]);

            const workoutsArray = Array.from({ length: parseInt(settings.workoutsPerWeek) || 0 });
            const setsArray = Array.from({ length: parseInt(settings.setsPerWorkout) || 0 });

            return (
                <div className={`min-h-screen transition-colors duration-500 font-sans ${theme === 'dark' ? 'bg-zinc-950 text-zinc-50' : 'bg-zinc-50 text-zinc-900'}`}>
                
                {notification && (
                    <Notification 
                    message={notification.message} 
                    type={notification.type} 
                    onClose={() => setNotification(null)} 
                    />
                )}

                <Modal
                    isOpen={!!importModalData}
                    onClose={() => setImportModalData(null)}
                    title="Confirm Import"
                    footer={
                    <>
                        <Button variant="ghost" onClick={() => setImportModalData(null)}>Cancel</Button>
                        <Button variant="primary" onClick={confirmImport}>Yes, Overwrite Data</Button>
                    </>
                    }
                >
                    <div className="flex flex-col gap-3">
                    <div className="flex items-start gap-3 rounded-lg bg-yellow-50 p-3 dark:bg-yellow-900/20">
                        <AlertCircle className="h-5 w-5 text-yellow-600 dark:text-yellow-500 shrink-0 mt-0.5" />
                        <div className="text-sm text-yellow-800 dark:text-yellow-200">
                        <p className="font-bold">Warning: This action cannot be undone.</p>
                        <p>Importing this file will completely overwrite your current progress and settings.</p>
                        </div>
                    </div>
                    <div className="text-sm text-zinc-500 dark:text-zinc-400 mt-2">
                        <p><strong>Backup Date:</strong> {importModalData && new Date(importModalData.exportDate).toLocaleDateString()}</p>
                        <p><strong>Exercises:</strong> {importModalData?.exercises?.length || 0}</p>
                    </div>
                    </div>
                </Modal>

                <header className="sticky top-0 z-20 border-b border-zinc-200 bg-white/90 backdrop-blur-xl dark:border-zinc-800 dark:bg-zinc-950/90 supports-[backdrop-filter]:bg-white/60">
                    <div className="container mx-auto flex h-16 items-center justify-between px-4 max-w-2xl">
                    <div className="flex items-center gap-2.5">
                        <div className="flex h-9 w-9 items-center justify-center rounded-xl bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-sm">
                        <Activity className="h-5 w-5" />
                        </div>
                        <span className="text-lg font-bold tracking-tight">Gym<span className="opacity-50 font-normal">Tracker</span></span>
                    </div>
                    
                    <button 
                        onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} 
                        className="group rounded-full bg-zinc-100 p-2 text-zinc-600 transition-colors hover:bg-zinc-200 dark:bg-zinc-900 dark:text-zinc-400 dark:hover:bg-zinc-800"
                    >
                        {theme === 'dark' ? <Sun className="h-5 w-5" /> : <Moon className="h-5 w-5" />}
                    </button>
                    </div>
                    
                    <div className="container mx-auto px-4 pb-3 max-w-2xl">
                    <div className="relative grid w-full grid-cols-2 rounded-xl bg-zinc-100 p-1 dark:bg-zinc-900/50 dark:border dark:border-zinc-800">
                        <button
                        onClick={() => setActiveTab('config')}
                        className={`relative z-10 rounded-lg py-2 text-sm font-semibold transition-all duration-200 ${activeTab === 'config' ? 'bg-white text-zinc-950 shadow-md dark:bg-zinc-800 dark:text-white dark:shadow-none' : 'text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200'}`}
                        >
                        Settings & Database
                        </button>
                        <button
                        onClick={() => setActiveTab('tracker')}
                        className={`relative z-10 rounded-lg py-2 text-sm font-semibold transition-all duration-200 ${activeTab === 'tracker' ? 'bg-white text-zinc-950 shadow-md dark:bg-zinc-800 dark:text-white dark:shadow-none' : 'text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-200'}`}
                        >
                        Workout Tracker
                        </button>
                    </div>
                    </div>
                </header>

                <main className="container mx-auto p-4 max-w-2xl space-y-6">
                    
                    {activeTab === 'config' && (
                    <div className="space-y-6 animate-in fade-in slide-in-from-bottom-3 duration-500">
                        
                        <section className="space-y-4">
                        <div className="flex items-center gap-2 px-1">
                            <Save className="h-4 w-4 text-zinc-500" />
                            <h3 className="text-sm font-bold uppercase tracking-wider text-zinc-500">Data Management</h3>
                        </div>
                        <Card className="p-5">
                            <div className="flex flex-col sm:flex-row gap-4">
                            <Button onClick={handleExportData} variant="outline" className="flex-1 gap-2 border-zinc-300 dark:border-zinc-700">
                                <Download className="h-4 w-4" />
                                Export Backup (JSON)
                            </Button>
                            
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                onChange={handleFileSelect} 
                                accept=".json" 
                                className="hidden" 
                            />
                            
                            <Button onClick={triggerFileInput} variant="outline" className="flex-1 gap-2 border-zinc-300 dark:border-zinc-700">
                                <Upload className="h-4 w-4" />
                                Import Backup
                            </Button>
                            </div>
                            <p className="mt-3 text-xs text-zinc-500 text-center">
                            Transfer progress between devices. Importing overwrites current data.
                            </p>
                        </Card>
                        </section>

                        <section className="space-y-4">
                        <div className="flex items-center gap-2 px-1">
                            <Settings className="h-4 w-4 text-zinc-500" />
                            <h3 className="text-sm font-bold uppercase tracking-wider text-zinc-500">Global Configuration</h3>
                        </div>
                        <Card className="p-5 space-y-4">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                                <CustomDatePicker 
                                label="Start Date" 
                                value={settings.startDate} 
                                onChange={(val) => setSettings({...settings, startDate: val})} 
                                />
                                
                                <Input 
                                label="Total Weeks" 
                                type="number" 
                                value={settings.totalWeeks} 
                                onChange={(e) => setSettings({...settings, totalWeeks: e.target.value})} 
                                />
                                <Input 
                                label="Sets / Exercise" 
                                type="number" 
                                value={settings.setsPerWorkout} 
                                onChange={(e) => setSettings({...settings, setsPerWorkout: e.target.value})} 
                                />
                                <Input 
                                label="Workouts / Week" 
                                type="number" 
                                value={settings.workoutsPerWeek} 
                                onChange={(e) => setSettings({...settings, workoutsPerWeek: e.target.value})} 
                                />
                            </div>
                            
                            <div className="pt-2 border-t border-zinc-100 dark:border-zinc-800">
                                <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400 mb-3 block">Define Workout Routines</label>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <Input 
                                        placeholder="e.g. Legs & Shoulders"
                                        value={settings.workoutNames[0]} 
                                        onChange={(e) => updateWorkoutName(0, e.target.value)}
                                    />
                                    <Input 
                                        placeholder="e.g. Chest & Back"
                                        value={settings.workoutNames[1]} 
                                        onChange={(e) => updateWorkoutName(1, e.target.value)}
                                    />
                                </div>
                            </div>
                        </Card>
                        </section>

                        <section className="space-y-4">
                        <div className="flex items-center gap-2 px-1">
                            <Plus className="h-4 w-4 text-zinc-500" />
                            <h3 className="text-sm font-bold uppercase tracking-wider text-zinc-500">Add Exercise</h3>
                        </div>
                        <Card className="p-5 space-y-4">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <Input 
                                label="Exercise Name" 
                                placeholder="Enter title..."
                                value={newExercise.name} 
                                onChange={(e) => setNewExercise({...newExercise, name: e.target.value})} 
                                />
                                
                                <CustomSelect 
                                label="Assign To Routine"
                                value={newExercise.assignedWorkout}
                                onChange={(val) => setNewExercise({...newExercise, assignedWorkout: val})}
                                options={[
                                    { value: 0, label: settings.workoutNames[0] || 'Workout 1' },
                                    { value: 1, label: settings.workoutNames[1] || 'Workout 2' }
                                ]}
                                placeholder="Select Routine"
                                />

                                <CustomSelect 
                                label="Muscle Group"
                                value={newExercise.muscleGroup}
                                onChange={(val) => setNewExercise({...newExercise, muscleGroup: val})}
                                options={MUSCLE_GROUPS}
                                placeholder="Select Muscle Group"
                                />
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4">
                            <Input 
                                label="Current Weight (kg)" 
                                type="number"
                                value={newExercise.currentWeight} 
                                onChange={(e) => setNewExercise({...newExercise, currentWeight: e.target.value})} 
                            />
                            <Input 
                                label="Target Weight (kg)" 
                                type="number"
                                value={newExercise.targetWeight} 
                                onChange={(e) => setNewExercise({...newExercise, targetWeight: e.target.value})} 
                            />
                            <Input 
                                label="Min Increment (kg)" 
                                type="number"
                                value={newExercise.increment} 
                                onChange={(e) => setNewExercise({...newExercise, increment: e.target.value})} 
                            />
                            <Input 
                                label="Target Reps" 
                                type="number"
                                value={newExercise.targetReps} 
                                onChange={(e) => setNewExercise({...newExercise, targetReps: e.target.value})} 
                            />
                            </div>
                            <Button onClick={addExercise} className="w-full mt-2" size="lg">
                            Add to Database
                            </Button>
                        </Card>
                        </section>

                        <section className="space-y-3 pt-4">
                        <h3 className="text-sm font-bold uppercase tracking-wider text-zinc-500 px-1">Database</h3>
                        {exercises.map((ex) => (
                            <div key={ex.id} className="group flex items-center justify-between p-4 bg-white border border-zinc-200 rounded-xl dark:bg-zinc-900/50 dark:border-zinc-800 shadow-sm transition-all hover:border-zinc-300 dark:hover:border-zinc-700">
                            <div>
                                <h4 className="font-bold text-lg tracking-tight">{ex.name}</h4>
                                <div className="text-xs text-zinc-500 flex flex-wrap gap-3 mt-1.5 font-medium">
                                    <span className="bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded text-zinc-600 dark:text-zinc-300">
                                        {settings.workoutNames[ex.assignedWorkout || 0]}
                                    </span>
                                    <span className="bg-indigo-50 dark:bg-indigo-900/30 px-2 py-0.5 rounded text-indigo-600 dark:text-indigo-300 capitalize">
                                        {ex.muscleGroup}
                                    </span>
                                <span className="flex items-center gap-1">
                                    Start: {ex.currentWeight}kg
                                </span>
                                <span className="flex items-center gap-1">
                                    Goal: {ex.targetWeight}kg
                                </span>
                                </div>
                            </div>
                            <Button variant="ghost" size="icon" onClick={() => removeExercise(ex.id)} className="text-zinc-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20">
                                <Trash2 className="h-5 w-5" />
                            </Button>
                            </div>
                        ))}
                        {exercises.length === 0 && (
                            <div className="rounded-xl border border-dashed border-zinc-300 p-8 text-center text-zinc-400 dark:border-zinc-700">
                            No exercises added yet.
                            </div>
                        )}
                        </section>
                    </div>
                    )}

                    {activeTab === 'tracker' && (
                    <div className="space-y-6 animate-in fade-in slide-in-from-bottom-3 duration-500">
                        
                        <div className="flex p-1 bg-zinc-100 dark:bg-zinc-900 rounded-xl">
                            {settings.workoutNames.map((name, idx) => (
                                <button
                                    key={idx}
                                    onClick={() => {
                                        setFilterWorkoutIndex(idx);
                                        setFilterMuscleGroup('all'); 
                                        const nextExercises = exercises.filter(e => (e.assignedWorkout || 0) === idx);
                                        if (nextExercises.length > 0) {
                                            setSelectedExerciseId(nextExercises[0].id);
                                            setViewWeekOffset(0);
                                        } else {
                                            setSelectedExerciseId(null);
                                        }
                                    }}
                                    className={`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${
                                        filterWorkoutIndex === idx 
                                        ? 'bg-white text-zinc-900 shadow-sm dark:bg-zinc-800 dark:text-white' 
                                        : 'text-zinc-500 hover:text-zinc-700 dark:text-zinc-400'
                                    }`}
                                >
                                    {name || `Workout ${idx + 1}`}
                                </button>
                            ))}
                        </div>

                        <div className="flex gap-2 overflow-x-auto pb-1 no-scrollbar -mx-2 px-2">
                            <button
                                onClick={() => setFilterMuscleGroup('all')}
                                className={`whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-semibold transition-colors border ${
                                    filterMuscleGroup === 'all'
                                    ? 'bg-zinc-900 text-white border-zinc-900 dark:bg-white dark:text-zinc-900 dark:border-white'
                                    : 'bg-white text-zinc-600 border-zinc-200 hover:bg-zinc-50 dark:bg-zinc-950 dark:text-zinc-400 dark:border-zinc-800 dark:hover:bg-zinc-900'
                                }`}
                            >
                                All Groups
                            </button>
                            {availableMuscleGroups.map((group) => (
                                <button
                                    key={group.value}
                                    onClick={() => setFilterMuscleGroup(group.value)}
                                    className={`whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-semibold transition-colors border ${
                                        filterMuscleGroup === group.value
                                        ? 'bg-zinc-900 text-white border-zinc-900 dark:bg-white dark:text-zinc-900 dark:border-white'
                                        : 'bg-white text-zinc-600 border-zinc-200 hover:bg-zinc-50 dark:bg-zinc-950 dark:text-zinc-400 dark:border-zinc-800 dark:hover:bg-zinc-900'
                                    }`}
                                >
                                    {group.label}
                                </button>
                            ))}
                        </div>

                        <CustomSelect 
                        value={selectedExerciseId || ''}
                        onChange={(val) => {
                            setSelectedExerciseId(val);
                            setViewWeekOffset(0);
                        }}
                        options={filteredExercises.map(ex => ({ value: ex.id, label: ex.name }))}
                        placeholder={filteredExercises.length === 0 ? "No exercises in this group" : "Select Exercise..."}
                        className="relative z-10"
                        />

                        {selectedExercise && (
                        <>
                            <div className="flex items-center justify-between rounded-2xl bg-zinc-100 p-2 dark:bg-zinc-900/50 border border-transparent dark:border-zinc-800">
                            <Button variant="ghost" size="icon" onClick={() => setViewWeekOffset(prev => prev - 1)}>
                                <ChevronLeft className="h-5 w-5" />
                            </Button>
                            
                            <div className="flex flex-col items-center">
                                <span className="text-[10px] font-bold uppercase tracking-widest text-zinc-400">Week</span>
                                <div className="flex items-baseline gap-2">
                                <span className="text-2xl font-black tracking-tighter">{displayedWeekIndex + 1}</span>
                                <span className="text-sm font-medium text-zinc-400">/ {settings.totalWeeks}</span>
                                </div>
                                {viewWeekOffset === 0 && (
                                <span className="mt-0.5 h-1 w-1 rounded-full bg-zinc-900 dark:bg-white"></span>
                                )}
                            </div>

                            <Button variant="ghost" size="icon" onClick={() => setViewWeekOffset(prev => prev + 1)}>
                                <ChevronRight className="h-5 w-5" />
                            </Button>
                            </div>

                            <div className="space-y-6">
                            {workoutsArray.map((_, wIndex) => {
                                const workoutLetter = String.fromCharCode(65 + wIndex);
                                
                                const dataPrev = calculateProgression(selectedExercise, settings, displayedWeekIndex - 1, wIndex);
                                const dataCurr = calculateProgression(selectedExercise, settings, displayedWeekIndex, wIndex);
                                const dataNext = calculateProgression(selectedExercise, settings, displayedWeekIndex + 1, wIndex);
                                
                                if (!dataCurr) return null;

                                return (
                                <Card key={wIndex} className="overflow-hidden border-0 shadow-lg shadow-zinc-200/50 dark:shadow-none ring-1 ring-zinc-200 dark:ring-zinc-800">
                                    <div className="bg-zinc-50 px-5 py-4 border-b border-zinc-100 dark:bg-zinc-900 dark:border-zinc-800 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-zinc-900 text-white font-bold text-sm dark:bg-white dark:text-zinc-900">
                                        {workoutLetter}
                                        </div>
                                        <h3 className="font-bold text-lg">Set Session</h3>
                                    </div>
                                    <div className="flex items-center gap-2 rounded-full bg-white px-3 py-1 text-sm font-semibold shadow-sm ring-1 ring-zinc-200 dark:bg-zinc-950 dark:ring-zinc-800">
                                        <span>{dataCurr.weight}</span>
                                        <span className="text-zinc-400 text-xs uppercase">kg</span>
                                    </div>
                                    </div>

                                    <div className="divide-y divide-zinc-100 dark:divide-zinc-800 bg-white dark:bg-zinc-950">
                                    <div className="grid grid-cols-12 gap-2 px-5 py-2.5 text-[10px] font-bold text-zinc-400 uppercase tracking-wider bg-zinc-50/50 dark:bg-zinc-900/30">
                                        <div className="col-span-2">Set</div>
                                        <div className="col-span-8 text-center">Reps</div>
                                        <div className="col-span-2 text-right">Status</div>
                                    </div>

                                    {setsArray.map((_, sIndex) => {
                                        const isCompleted = history[selectedExerciseId]?.[displayedWeekIndex]?.[wIndex]?.[sIndex];
                                        
                                        const prevReps = dataPrev ? dataPrev.reps[sIndex] : '-';
                                        const currReps = dataCurr.reps[sIndex];
                                        const nextReps = dataNext ? dataNext.reps[sIndex] : '-';

                                        const prevWeight = dataPrev?.weight;
                                        const nextWeight = dataNext?.weight;

                                        return (
                                        <div key={sIndex} className={`group grid grid-cols-12 gap-2 px-5 py-4 items-center transition-all ${isCompleted ? 'bg-zinc-50 dark:bg-zinc-900/40' : ''}`}>
                                            <div className="col-span-2">
                                            <span className="flex h-6 w-6 items-center justify-center rounded-full bg-zinc-100 text-xs font-bold text-zinc-500 dark:bg-zinc-800 dark:text-zinc-400">
                                                {sIndex + 1}
                                            </span>
                                            </div>

                                            <div className="col-span-8 flex flex-col items-center justify-center relative">
                                            <div className="hidden sm:block absolute left-0 text-[10px] font-medium text-zinc-300 dark:text-zinc-700">
                                                {prevWeight}kg × {prevReps}
                                            </div>
                                            
                                            <div className="flex items-baseline gap-1.5">
                                                <span className={`text-3xl font-black tracking-tighter ${isCompleted ? 'text-zinc-400 dark:text-zinc-600' : 'text-zinc-900 dark:text-white'}`}>
                                                {currReps}
                                                </span>
                                                <span className="text-[10px] font-bold uppercase tracking-wider text-zinc-400">reps</span>
                                            </div>

                                            <div className="hidden sm:block absolute right-0 text-[10px] font-medium text-zinc-300 dark:text-zinc-700">
                                                {nextWeight}kg × {nextReps}
                                            </div>
                                            </div>

                                            <div className="col-span-2 flex justify-end">
                                            <button
                                                onClick={() => toggleSetComplete(displayedWeekIndex, wIndex, sIndex)}
                                                className={`flex h-9 w-9 items-center justify-center rounded-full border transition-all duration-300 ${
                                                isCompleted 
                                                    ? 'border-zinc-900 bg-zinc-900 text-white dark:border-white dark:bg-white dark:text-zinc-900 scale-105' 
                                                    : 'border-zinc-200 text-zinc-300 hover:border-zinc-300 hover:bg-zinc-50 dark:border-zinc-700 dark:text-zinc-600 dark:hover:border-zinc-600 dark:hover:bg-zinc-900'
                                                }`}
                                            >
                                                <CheckCircle2 className={`h-5 w-5 ${isCompleted ? 'stroke-[3px]' : 'stroke-2'}`} />
                                            </button>
                                            </div>
                                        </div>
                                        );
                                    })}
                                    </div>
                                </Card>
                                );
                            })}
                            </div>

                            {stats && (
                            <div className="mt-8 overflow-hidden rounded-2xl border border-zinc-200 bg-white shadow-sm transition-all dark:border-zinc-700/50 dark:bg-zinc-900">
                                <div className="p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <div className="flex items-center gap-3">
                                    <div className="flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-500/10 text-indigo-600 dark:bg-indigo-500/20 dark:text-indigo-400">
                                        <BarChart3 className="h-5 w-5" />
                                    </div>
                                    <div>
                                        <h4 className="text-sm font-medium text-zinc-500 dark:text-zinc-400">Performance</h4>
                                        <p className="text-lg font-bold text-zinc-900 dark:text-zinc-100">Progression Stats</p>
                                    </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-6">
                                    <div className="space-y-1">
                                    <span className="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-zinc-400">
                                        <CalendarDays className="h-3 w-3" />
                                        Frequency
                                    </span>
                                    <p className="text-2xl font-bold tracking-tight text-zinc-800 dark:text-zinc-200">
                                        {stats.weeksPerIncrease} <span className="text-sm font-normal text-zinc-500">weeks</span>
                                    </p>
                                    </div>

                                    <div className="space-y-1 text-right">
                                    <span className="flex items-center justify-end gap-2 text-xs font-semibold uppercase tracking-wider text-zinc-400">
                                        <Target className="h-3 w-3" />
                                        Overall Goal
                                    </span>
                                    <p className="text-2xl font-bold tracking-tight text-zinc-800 dark:text-zinc-200">
                                        {stats.progressPercent}%
                                    </p>
                                    </div>
                                </div>

                                <div className="mt-6">
                                    <div className="relative h-3 w-full rounded-full bg-zinc-100 dark:bg-zinc-800">
                                    <div
                                        className="absolute inset-y-0 left-0 rounded-full bg-indigo-600 transition-all duration-1000 ease-out dark:bg-indigo-500"
                                        style={{ 
                                        width: `${stats.progressPercent}%`,
                                        boxShadow: '0 0 12px rgba(79, 70, 229, 0.4)' 
                                        }}
                                    />
                                    </div>
                                    <div className="mt-2 flex justify-between text-[10px] font-medium uppercase tracking-tighter text-zinc-400">
                                    <span>Start</span>
                                    <span>Target Reached</span>
                                    </div>
                                </div>
                                </div>
                            </div>
                            )}
                        </>
                        )}

                        {!selectedExercise && filteredExercises.length === 0 && filterMuscleGroup !== 'all' && (
                            <div className="flex flex-col items-center justify-center py-20 text-center opacity-70">
                                <Layers className="h-12 w-12 mb-3 text-zinc-300 dark:text-zinc-700" />
                                <p className="text-sm font-medium">No <span className="font-bold capitalize">{filterMuscleGroup}</span> exercises in this routine.</p>
                            </div>
                        )}

                        {!selectedExercise && filteredExercises.length === 0 && filterMuscleGroup === 'all' && (
                            <div className="flex flex-col items-center justify-center py-20 text-center opacity-70">
                                <Dumbbell className="h-12 w-12 mb-3 text-zinc-300 dark:text-zinc-700" />
                                <p className="text-sm font-medium">No exercises found for <span className="font-bold">{settings.workoutNames[filterWorkoutIndex]}</span>.</p>
                                <button onClick={() => setActiveTab('config')} className="text-xs mt-2 underline text-zinc-500">Add one in Settings</button>
                            </div>
                        )}

                        {(!selectedExercise && filteredExercises.length > 0) && (
                        <div className="flex flex-col items-center justify-center py-24 text-center">
                            <div className="rounded-full bg-zinc-100 p-6 dark:bg-zinc-900">
                            <Dumbbell className="h-10 w-10 text-zinc-300 dark:text-zinc-700" />
                            </div>
                            <h3 className="mt-4 text-lg font-bold text-zinc-900 dark:text-white">Select an Exercise</h3>
                            <p className="text-zinc-500 max-w-xs mx-auto mt-2">Choose an exercise from the list above to view your progression.</p>
                        </div>
                        )}
                    </div>
                    )}
                </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GymTrackerApp />);
    </script>
</body>
</html>
